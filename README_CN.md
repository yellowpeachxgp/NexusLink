<p align="center">
  <h1 align="center">NexusLink</h1>
  <p align="center">
    <strong>混合架构即时通讯平台 — 中心化与去中心化的桥梁</strong>
  </p>
  <p align="center">
    <a href="./README.md">English</a> |
    <a href="./docs/cn/architecture.md">架构设计</a> |
    <a href="./ROADMAP.md">开发路线图</a> |
    <a href="./CONTRIBUTING.md">参与贡献</a>
  </p>
</p>

---

## NexusLink 是什么？

NexusLink 是一个开源、跨平台的即时通讯应用，独特地在**同一个 App 中融合了中心化与去中心化通讯**。用户自主选择连接方式——官方目录服务器、自建社区服务器或点对点直连——无需在易用性和安全性之间妥协。

**无需手机号。无需邮箱。无需注册。** 你的身份是由设备安全硬件生成的加密密钥对。身份属于你自己。

### 当前痛点

| 中心化应用（微信、Telegram、Discord） | 去中心化应用（Signal、Briar、Session） |
|---|---|
| 易用、功能丰富 | 隐私优先、抗审查 |
| 用户交出数据主权 | 社交/社区功能受限 |
| 单点故障与监控风险 | 用户体验割裂 |
| 无法选择数据托管方 | 普通用户技术门槛高 |

**NexusLink 填补这个空白** — 兼具中心化平台的社区功能与去中心化的隐私和数据主权，让每个用户自己决定信任级别。

---

## 核心特性

### 无需注册的身份系统
- 设备安全硬件（TPM / Secure Enclave / StrongBox）生成加密密钥对
- 公钥 **即** UUID — 身份创建完全不依赖服务器
- 通过交叉签名协议实现多设备同步
- 助记词恢复短语（12-24 个单词）支持身份迁移

### 三种连接模式

```
┌──────────────────────────────────────────────────────────────┐
│                     NexusLink 客户端                          │
│                                                              │
│  [A] 官方服务器        [B] 社区服务器         [C] P2P 直连    │
│  - 实名认证           - 自建自管             - 设备直连       │
│  - 浏览社区目录       - 数据主权             - 无需服务器     │
│  - 官方监管频道       - 自定义规则           - 端到端加密     │
└──────────────────────────────────────────────────────────────┘
```

**模式 A：官方目录服务器**
- 需要 UUID 实名认证（KYC）
- 浏览和加入已注册的社区
- 访问官方公共频道
- 防滥用保护机制

**模式 B：社区自建服务器**
- 任何人都可以用同一套服务端代码部署
- 可选择注册到官方目录以获得可发现性
- 完全的数据主权 — 官方服务器永远看不到你的消息、成员或元数据
- 社区自定义管理规则

**模式 C：点对点直连**
- 通过 libp2p + WebRTC 实现设备间直接通讯
- 通过二维码或线下方式交换公钥
- 零服务器依赖（仅需 STUN 进行 NAT 穿透）
- 敏感对话的最高隐私级别

### 架构级隐私保护
- 所有消息端到端加密（Double Ratchet 协议）
- 官方目录服务器**仅是电话簿** — 只存储社区列表，不存储消息和成员信息
- 社区服务器是**隐私隔离层** — 元数据不会流向官方服务器
- 为未来的零知识证明 KYC 预留接口（证明身份而不泄露细节）

### 全平台支持
- iOS、Android、Windows、macOS、Linux
- Flutter UI + Rust 核心，通过 FFI 桥接
- 所有平台体验一致

---

## 架构概览

```
┌──────────────────────────────────────────────────────────────┐
│                          客户端                               │
│  ┌────────────────────┐  ┌─────────────────────────────────┐ │
│  │   Flutter UI 层    │  │       Rust 核心库               │ │
│  │                    │◄─┤  - 身份管理（安全硬件）          │ │
│  │  - 聊天界面        │  │  - 端到端加密                   │ │
│  │  - 社区浏览        │  │  - P2P 网络（libp2p）           │ │
│  │  - 设置            │  │  - 协议编解码                   │ │
│  │  - 多语言支持      │  │  - 本地加密存储                 │ │
│  └────────────────────┘  └─────────────────────────────────┘ │
└──────────────────┬───────────────────┬───────────────────────┘
                   │                   │
         ┌─────────┘                   └──────────┐
         ▼                                        ▼
┌─────────────────────┐               ┌───────────────────────┐
│   目录服务器（官方） │               │   社区服务器（自建）   │
│                     │               │                       │
│  - 社区索引          │    注册       │  - 聊天托管           │
│  - 实名认证          │◄────────────┤  - 成员管理           │
│  - 滥用举报          │  （仅元信息） │  - 文件存储           │
│                     │               │  - 自定义管理         │
└─────────────────────┘               └───────────────────────┘
                                               │
                                      P2P 直连通道
                                               │
                                      ┌────────▼──────────┐
                                      │    其他客户端       │
                                      └───────────────────┘
```

详细架构文档请参阅 [架构设计文档](./docs/cn/architecture.md)。

---

## 技术栈

| 层级 | 技术 | 用途 |
|------|-----|------|
| **界面** | Flutter (Dart) | 跨平台原生 UI |
| **核心** | Rust | 密码学、网络、协议逻辑 |
| **桥接** | flutter_rust_bridge / FFI | 连接 Flutter 与 Rust |
| **身份** | nmshd/rust-crypto | 安全硬件密钥管理 |
| **加密** | Double Ratchet + X3DH | 端到端消息加密 |
| **P2P** | libp2p + WebRTC | 点对点直连 |
| **服务端** | Rust (Axum / Actix-web) | HTTP/gRPC 服务框架 |
| **数据库** | PostgreSQL（服务端）、SQLCipher（客户端） | 持久化存储 |
| **序列化** | Protocol Buffers / FlatBuffers | 传输格式 |
| **CI/CD** | GitHub Actions | 自动化测试与发布 |

---

## 与现有方案的对比

| 特性 | NexusLink | Matrix | Telegram | Signal | Session |
|------|-----------|--------|----------|--------|---------|
| 无需注册 | 是（硬件密钥） | 否 | 否（手机号） | 否（手机号） | 是（密钥） |
| 默认端到端加密 | 是 | 可选 | 否 | 是 | 是 |
| 自建社区服务器 | 是 | 是（联邦） | 否 | 否 | 否 |
| P2P 直连模式 | 是 | 计划中 | 否 | 否 | 是（洋葱路由） |
| 官方目录 | 是 | matrix.org | Telegram Inc. | 无 | 无 |
| 隐私隔离 | 是（架构级） | 否（元数据泄露） | 否 | 无 | 部分 |
| 实名认证（可选） | 是（仅官方） | 否 | 否 | 否 | 否 |
| 多设备同步 | 是 | 是 | 是 | 是 | 是 |
| 身份恢复 | 助记词 | 密码 | 手机/云 | 手机/PIN | 助记词 |

---

## 安全模型

### 威胁模型

| 威胁 | 缓解措施 |
|------|---------|
| 服务器被入侵 | 端到端加密 — 服务器永远没有明文消息 |
| 身份盗用 | 私钥存储在安全硬件中 — 无法导出 |
| 元数据监控（官方） | 目录服务器无权访问通讯数据 |
| 元数据监控（社区） | 社区服务器可见元数据但不可见内容；用户选择信任哪个服务器 |
| 设备丢失 | 助记词恢复短语可在新设备恢复身份 |
| 中间人攻击 | 通过二维码/安全号码验证公钥 |

### NexusLink 不能防护的场景
- 被入侵的社区服务器可以看到通讯元数据（谁和谁在什么时候通讯）— 这是为易用性做出的有意权衡
- 如果用户设备被入侵（恶意软件、root 权限），攻击者可以访问解密后的消息
- P2P 模式需要 STUN 服务器进行 NAT 穿透；这些服务器可以看到 IP 地址（但看不到消息内容）

---

## 开发路线图

详见 [ROADMAP.md](./ROADMAP.md)。

| 阶段 | 重点 | 状态 |
|------|------|------|
| 第 0 阶段 | 项目搭建、CI/CD、协议规范 | 计划中 |
| 第 1 阶段 | 身份系统、端到端加密核心 | 计划中 |
| 第 2 阶段 | P2P 消息传递（模式 C） | 计划中 |
| 第 3 阶段 | 社区服务器（模式 B） | 计划中 |
| 第 4 阶段 | 目录服务器 + 实名认证（模式 A） | 计划中 |
| 第 5 阶段 | 全平台发布与打磨 | 计划中 |
| 第 6 阶段 | 高级功能（语音、文件、ZKP） | 计划中 |

---

## 参与贡献

详见 [CONTRIBUTING.md](./CONTRIBUTING.md)。

欢迎以下方面的贡献：
- 协议设计与安全审查
- Rust 核心库开发
- Flutter UI/UX 设计与实现
- 服务端开发
- 文档编写与翻译
- 安全审计

---

## 许可证

NexusLink 采用 [GNU Affero 通用公共许可证 v3.0](./LICENSE) 授权。

这意味着：
- 你可以自由使用、修改和分发 NexusLink
- 任何修改必须同样以 AGPLv3 开源
- 如果你将修改版本作为网络服务运行，必须向用户提供源代码
- 这确保 NexusLink 始终对所有人保持开放和免费

---

## 致谢

NexusLink 建立在众多开源项目和协议的研究成果之上：

- [Signal 协议](https://signal.org/docs/) — Double Ratchet 和 X3DH 密钥协商
- [Matrix](https://matrix.org/) — 联邦消息传递和交叉签名概念
- [libp2p](https://libp2p.io/) — 点对点网络协议栈
- [nmshd/rust-crypto](https://github.com/nmshd/rust-crypto) — 跨平台安全硬件抽象
- [Session](https://getsession.org/) — 无需注册的去中心化身份

---

<p align="center">
  <strong>你的消息。你的身份。你的选择。</strong>
</p>
